---
layout: post
title: 网站编码格式的问题
permalink: /2014/11/encoding
---
<style type="text/css">
t{
  color:blue;
  font-size:18px;
}
pl{
  color:#FF7F24;
  font-size:16px;
}
</style>

<pl>
&nbsp;&nbsp;&nbsp;&nbsp;最近修改师兄做的一个.net的网站，过程中遇到了编码格式出错从而导致乱码的问题。<br/></pl>



<t>问题情景:</t>
>&nbsp;&nbsp;&nbsp;&nbsp;我在本地VS2010上调试代码时没有出现码错误，但是当我上传到服务器上后，调试出现乱码。


<t>我最初的解决方法</t>
>&nbsp;&nbsp;&nbsp;&nbsp;检查网站代码编码格式和数据库编码格式是否匹配，即交给数据库时的编码格式是否是与数据库接收时默认的编码格式相匹配。具体来说：mysql中的mysql_character_client的编码是否与我连接数据库时在配置文件中设置的或连接时代码中设置的的编码格式相同。

<t>后来的思路:</t>
>&nbsp;&nbsp;&nbsp;&nbsp;为什么放到服务器上就有问题呢？服务器和本地的差异是iis的编码配置。整个网站大致是Browse<->Server<->MySQL,要确保两两之间的连接的编码格式相同。对于服务器和Mysql各自内部转码可以不用考虑。我统一了各自编码后，发现依旧乱码。然后我检查了服务器端乱码的格式，发现是cp850，但是浏览器用的是utf8，出现乱码就不足为奇了。但是这个cp850是哪里来的编码格式呢？<br/>&nbsp;&nbsp;&nbsp;&nbsp;因为我上传了三个系统，另外两个编码无问题，但是这个系统编码就有问题。后来我想到服务器是英文版的，果然系统默认编码格式就是网页显示的格式。后来汉化了操作系统，修改了操作系统的编码格式，解决了问题。然而为什么其他两个系统没有问题呢？由于最初的代码不是我写的［至少可以确定问题出现在asp.net项目中］，所以我没有找出具体哪行代码导致了这个问题，至少连接部分我都确认过是编码匹配的，唯一与往常不同的是这次运用到了MysqlDriverCs.dll的动态库，所以我猜可能是这个问题。

<pl>
&nbsp;&nbsp;&nbsp;&nbsp;网站编码出错的情况很常见，但是检查问题的思路最为重要，从数据库到服务器再到浏览器，步步匹配。</pl>
